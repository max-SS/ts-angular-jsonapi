!function(n){n.module("Jsonapi.config",[]).constant("rsJsonapiConfig",{url:"http://yourdomain/api/v1/",delay:0,unify_concurrency:!0,cache_prerequests:!0}),n.module("Jsonapi.services",[]),n.module("rsJsonapi",["angular-storage","Jsonapi.config","Jsonapi.services"])}(angular);
var Jsonapi;!function(n){var a=function(){function n(){}return n.Params={id:"",include:[]},n.Schema={attributes:{},relationships:{}},n}();n.Base=a}(Jsonapi||(Jsonapi={}));
var Jsonapi;!function(e){var o=function(){function o(e,o,t,n){this.$http=e,this.$timeout=o,this.rsJsonapiConfig=t,this.$q=n}return o.$inject=["$http","$timeout","rsJsonapiConfig","$q"],o.prototype["delete"]=function(e){return this.exec(e,"DELETE")},o.prototype.get=function(e){return this.exec(e,"GET")},o.prototype.exec=function(o,t,n){var r={method:t,url:this.rsJsonapiConfig.url+o,headers:{"Content-Type":"application/vnd.api+json"}};n&&(r.data=n);var i=this.$http(r),s=this.$q.defer(),a=this;return e.Core.Me.refreshLoadings(1),i.then(function(o){a.$timeout(function(){e.Core.Me.refreshLoadings(-1),s.resolve(o)},a.rsJsonapiConfig.delay)},function(o){e.Core.Me.refreshLoadings(-1),o.status<=0?e.Core.Me.loadingsOffline(o)||console.warn("Jsonapi.Http.exec (use JsonapiCore.loadingsOffline for catch it) error =>",o):e.Core.Me.loadingsError(o)||console.warn("Jsonapi.Http.exec (use JsonapiCore.loadingsError for catch it) error =>",o),s.reject(o)}),s.promise},o}();e.Http=o,angular.module("Jsonapi.services").service("JsonapiHttp",o)}(Jsonapi||(Jsonapi={}));
var Jsonapi;!function(t){var n=function(){function t(){}return t.prototype.passFilter=function(t,n){for(var r in n)if(r in t.attributes&&t.attributes[r]===n[r])return!0;return!1},t}();t.Filter=n}(Jsonapi||(Jsonapi={}));
var Jsonapi;!function(t){var n=function(){function t(){this.paths=[],this.includes=[]}return t.prototype.addPath=function(t){this.paths.push(t)},t.prototype.setInclude=function(t){this.includes=t},t.prototype.get=function(){var t=[];return this.includes.length>0&&t.push("include="+this.includes.join(",")),this.paths.join("/")+(t.length>0?"?"+t.join("&"):"")},t}();t.PathMaker=n}(Jsonapi||(Jsonapi={}));
var Jsonapi;!function(e){var r=function(){function r(){}return r.json_array2resources_array=function(r,n,t){void 0===t&&(t=!1),n||(n=[]);for(var i=0,a=0,o=r;a<o.length;a++){var s=o[a],u=e.Converter.json2resource(s,!1);t?n[u.id]=u:n[u.type+"_"+u.id]=u,i++}return n},r.json_array2resources_array_by_type=function(e,n){var t={};r.json_array2resources_array(e,t,!1);var i={};return angular.forEach(t,function(e){e.type in i||(i[e.type]={}),i[e.type][e.id]=e}),i},r.json2resource=function(r,n){var t=e.Converter.getService(r.type);if(t)return e.Converter.procreate(t,r);console.warn("`"+r.type+"`","service not found on json2resource()");var i=new e.Resource;return i.id=r.id,i.type=r.type,i},r.getService=function(r){var n=e.Core.Me.getResource(r);return angular.isUndefined(n)&&console.warn("`"+r+"`","service not found on getService()"),n},r.procreate=function(e,r){"type"in r&&"id"in r||console.error("Jsonapi Resource is not correct",r);var n=new e.constructor;return n["new"](),n.id=r.id,n.attributes=r.attributes?r.attributes:{},n.is_new=!1,n},r.build=function(e,n,t){var i={};"included"in e&&(i=r.json_array2resources_array_by_type(e.included,!1)),angular.isArray(e.data)?r._buildResources(e,n,t,i):r._buildResource(e.data,n,t,i)},r._buildResources=function(n,t,i,a){for(var o=0,s=n.data;o<s.length;o++){var u=s[o],c=e.Converter.getService(u.type);u.id in t||(t[u.id]=new c.constructor,t[u.id].reset()),r._buildResource(u,t[u.id],i,a)}},r._buildResource=function(e,n,t,i){n.attributes=e.attributes,n.id=e.id,n.is_new=!1,r.__buildRelationships(e.relationships,n.relationships,i,t)},r.__buildRelationships=function(n,t,i,a){angular.forEach(n,function(n,o){if(!(o in t)&&"data"in n&&(t[o]={data:[]}),n.data)if(a.relationships[o]&&a.relationships[o].hasMany){if(n.data.length<1)return;var s=e.Converter.getService(n.data[0].type);s&&(t[o].data={},angular.forEach(n.data,function(e){var n=r.__buildRelationship(e,i);t[o].data[n.id]=n}))}else t[o].data=r.__buildRelationship(n.data,i)})},r.__buildRelationship=function(e,r){return e.type in r&&e.id in r[e.type]?r[e.type][e.id]:e},r}();e.Converter=r}(Jsonapi||(Jsonapi={}));
var Jsonapi;!function(i){var o=function(){function o(o,s){this.rsJsonapiConfig=o,this.JsonapiCoreServices=s,this.rootPath="http://reyesoft.ddns.net:9999/api/v1/companies/2",this.resources=[],this.loadingsCounter=0,this.loadingsStart=function(){},this.loadingsDone=function(){},this.loadingsError=function(){},this.loadingsOffline=function(){},i.Core.Me=this,i.Core.Services=s}return o.$inject=["rsJsonapiConfig","JsonapiCoreServices"],o.prototype._register=function(i){return!(i.type in this.resources)&&(this.resources[i.type]=i,!0)},o.prototype.getResource=function(i){return this.resources[i]},o.prototype.refreshLoadings=function(i){this.loadingsCounter+=i,0===this.loadingsCounter?this.loadingsDone():1===this.loadingsCounter&&this.loadingsStart()},o.Me=null,o.Services=null,o}();i.Core=o,angular.module("Jsonapi.services").service("JsonapiCore",o)}(Jsonapi||(Jsonapi={}));
var Jsonapi;!function(t){var e=function(){function e(){this.is_new=!0,this.relationships={},this.cache_vars={}}return e.prototype.clone=function(){var t=new this.constructor;for(var e in this)"object"!=typeof this[e]&&(t[e]=this[e]);return t},e.prototype.register=function(){if(null===t.Core.Me)throw"Error: you are trying register --> "+this.type+" <-- before inject JsonapiCore somewhere, almost one time.";return this.cache={},t.Core.Me._register(this)},e.prototype.getPath=function(){return this.path?this.path:this.type},e.prototype["new"]=function(){var t=this.clone();return t.reset(),t},e.prototype.reset=function(){var t=this;this.id="",this.attributes={},this.relationships={},angular.forEach(this.schema.relationships,function(e,a){t.relationships[a]={},t.relationships[a].data={}}),this.is_new=!0},e.prototype.toObject=function(e){var a=this;e=angular.extend({},t.Base.Params,e),this.schema=angular.extend({},t.Base.Schema,this.schema);var i={},n=[],s=[];angular.forEach(this.relationships,function(t,r){if(a.schema.relationships[r]&&a.schema.relationships[r].hasMany)i[r]={data:[]},angular.forEach(t.data,function(t){var a={id:t.id,type:t.type};i[r].data.push(a);var h=t.type+"_"+t.id;s.indexOf(h)===-1&&e.include.indexOf(r)!==-1&&(s.push(h),n.push(t.toObject({}).data))});else{"id"in t.data||angular.equals({},t.data)||console.warn(r+" defined with hasMany:false, but I have a collection"),t.data.id&&t.data.type?i[r]={data:{id:t.data.id,type:t.data.type}}:i[r]={data:{}};var h=t.data.type+"_"+t.data.id;s.indexOf(h)===-1&&e.include.indexOf(t.data.type)!==-1&&(s.push(h),n.push(t.data.toObject({}).data))}});var r={data:{type:this.type,id:this.id,attributes:this.attributes,relationships:i}};return n.length>0&&(r.included=n),r},e.prototype.get=function(t,e,a,i){return this.__exec(t,e,a,i,"get")},e.prototype["delete"]=function(t,e,a,i){this.__exec(t,e,a,i,"delete")},e.prototype.all=function(t,e,a){return this.__exec(null,t,e,a,"all")},e.prototype.getRelationships=function(t,e,a,i){return this.__exec(t,e,a,i,"getRelationships")},e.prototype.save=function(t,e,a){return this.__exec(null,t,e,a,"save")},e.prototype.__exec=function(e,a,i,n,s){switch(angular.isFunction(a)?(n=i,i=a,a=angular.extend({},t.Base.Params)):a=angular.isUndefined(a)?angular.extend({},t.Base.Params):angular.extend({},t.Base.Params,a),i=angular.isFunction(i)?i:function(){},n=angular.isFunction(n)?n:function(){},this.schema=angular.extend({},t.Base.Schema,this.schema),s){case"get":return this._get(e,a,i,n);case"getRelationships":return a.path=e,this._all(a,i,n);case"delete":return this._delete(e,a,i,n);case"all":return this._all(a,i,n);case"save":return this._save(a,i,n)}},e.prototype._get=function(e,a,i,n){var s=this,r=new t.PathMaker;r.addPath(this.getPath()),r.addPath(e),a.include?r.setInclude(a.include):null;var h=this.getService().cache&&this.getService().cache[e]?this.getService().cache[e]:this["new"]();return t.Core.Services.JsonapiHttp.get(r.get()).then(function(e){t.Converter.build(e.data,h,s.schema),s.fillCacheResource(h),i(e)},function(t){n(t)}),h},e.prototype._all=function(e,a,i){var n=this,s=new t.PathMaker;s.addPath(this.getPath()),e.path?s.addPath(e.path):null,e.include?s.setInclude(e.include):null;var r;if(r=Object.defineProperties({},{$length:{get:function(){return Object.keys(this).length},enumerable:!1},$isloading:{value:!1,enumerable:!1,writable:!0},$source:{value:"",enumerable:!1,writable:!0}}),!e.path&&this.getService().cache&&this.getService().cache_vars.__path===this.getPath()){r.$source="cache";var h=new t.Filter;angular.forEach(this.getService().cache,function(t,a){e.filter&&!h.passFilter(t,e.filter)||(r[a]=t)})}return r.$isloading=!0,t.Core.Services.JsonapiHttp.get(s.get()).then(function(i){if(r.$source="server",r.$isloading=!1,t.Converter.build(i.data,r,n.schema),e.path||n.fillCache(r),e.filter){var s=new t.Filter;angular.forEach(r,function(t,a){s.passFilter(t,e.filter)||delete r[a]})}a(i)},function(t){r.$source="server",r.$isloading=!1,i(t)}),r},e.prototype._delete=function(e,a,i,n){var s=this,r=new t.PathMaker;r.addPath(this.getPath()),r.addPath(e),t.Core.Services.JsonapiHttp["delete"](r.get()).then(function(t){s.getService().cache&&s.getService().cache[e]&&(s.getService().cache[e].id="",s.getService().cache[e].attributes=null,delete s.getService().cache[e]),i(t)},function(t){n(t)})},e.prototype._save=function(e,a,i){var n=this.toObject(e),s=new t.PathMaker;s.addPath(this.getPath()),this.id&&s.addPath(this.id),e.include?s.setInclude(e.include):null;var r=this["new"](),h=t.Core.Services.JsonapiHttp.exec(s.get(),this.id?"PUT":"POST",n);return h.then(function(t){var e=t.data.data;r.attributes=e.attributes,r.id=e.id,a(t)},function(t){i("data"in t?t.data:t)}),r},e.prototype.addRelationship=function(t,e){var a=t.id;a||(a="new_"+Math.floor(1e5*Math.random())),e=e?e:t.type,e in this.relationships||(this.relationships[e]={data:{}}),this.schema.relationships[e].hasMany?this.relationships[e].data[a]=t:this.relationships[e].data=t},e.prototype.addRelationships=function(t,e){var a=this;e in this.relationships||(this.relationships[e]={data:{}}),this.schema.relationships[e].hasMany||console.warn("addRelationships not supported on "+this.type+" schema."),angular.forEach(t,function(t){a.relationships[e].data[t.id]=t})},e.prototype.removeRelationship=function(t,e){return t in this.relationships&&("data"in this.relationships[t]&&(e in this.relationships[t].data&&(delete this.relationships[t].data[e],!0)))},e.prototype.fillCache=function(t){t.id?this.fillCacheResource(t):(this.getService().cache_vars.__path=this.getPath(),this.fillCacheResources(t))},e.prototype.fillCacheResources=function(t){var e=this;angular.forEach(t,function(t){e.fillCacheResource(t)})},e.prototype.fillCacheResource=function(t){t.id&&(this.getService().cache[t.id]=t)},e.prototype.getService=function(){return t.Converter.getService(this.type)},e}();t.Resource=e}(Jsonapi||(Jsonapi={}));

var Jsonapi;!function(i){var n=function(){function i(i){this.JsonapiHttp=i}return i.$inject=["JsonapiHttp"],i}();i.CoreServices=n,angular.module("Jsonapi.services").service("JsonapiCoreServices",n)}(Jsonapi||(Jsonapi={}));
var Jsonapi;!function(n){var o=function(){function n(){}return n.prototype.toObject=function(n){return n},n}();n.JsonapiParser=o}(Jsonapi||(Jsonapi={}));
var Jsonapi;!function(n){var o=function(){function n(){}return n.prototype.get=function(n){},n.prototype.merge=function(n,o){},n}();n.JsonapiStorage=o}(Jsonapi||(Jsonapi={}));